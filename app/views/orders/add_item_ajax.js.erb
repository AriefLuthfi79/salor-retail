<% if @order_item then %>
  <% @order_item.reload if @order_item.behavior == 'coupon'  %>
   order_item_json = <%= raw @order_item.to_json %>;
   updateOrderItems([order_item_json]);
   updateOrder(order_item_json);
   writeToPole(order_item_json);
   if (order_item_json.price == 0 ) {
     playSound('medium_warning');
   } else {
     playSound('drop2');
   }
   try {
    display_change();
   } catch (err) {
    //just fail
   }
   <%
     if @order_item.behavior == 'coupon' then
     ois = @order.order_items.joins(:item).where("`items`.sku = '#{@order_item.item.coupon_applies}'")
       if ois then
         ois.each do |oi|
         %>
            updateOrderItems([<%= raw oi.to_json %>]);
         <%
         end
       end
     end
   %>
<% else %>
  $('.notice-container').html('');
  $('.notice-container').html('<%= t("system.errors.unspecified_error") %>');
  //initNotice();
<% end %>
<%= render :partial => "shared/js/global_errors_js" %>
focusInput($('#keyboard_input'));
